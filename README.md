# 処方箋服用スケジュール管理アプリ

処方された薬の服用スケジュールを管理し、飲み忘れを防ぐための Web アプリケーションです。  
体調を崩した時、5日分の処方箋を処方されたのに5日後には1回分余っていて、いつ飲み忘れたのか朧げになった実体験から開発しました。  
天気情報と連携し、気温・湿度に基づいた薬の保管環境アラートも提供します。  

---

## 主な機能

| 機能 | 説明 |
|---|---|
| 薬剤管理 | 薬品名・服用量・服用回数・服用時刻・服用期間の登録・編集・削除 |
| 服用スケジュール | 指定日の服用予定一覧を表示し、服用済みチェックを記録 |
| カレンダー表示 | 月カレンダーで服用状況（完了数／総数）を日付ごとに確認 |
| 天気連携 | 現在地の気温・湿度を取得し、薬の保管環境を警告またはバナー表示 |
| オフライン動作 | IndexedDB にデータを永続化するため、インターネット接続不要で動作 |

---

## 技術スタック

| カテゴリ | ライブラリ・バージョン |
|---|---|
| UI フレームワーク | React 18.2.0 |
| 言語 | TypeScript 5.4.0 |
| ビルドツール | Vite 4.0.0 |
| ルーティング | React Router DOM 7.13.0 |
| 状態管理 | Zustand 5.0.11 |
| ローカル DB | Dexie (IndexedDB ラッパー) 4.3.0 |
| 日時操作 | Day.js 1.11.19 |
| カレンダー UI | React Calendar 6.0.0 |
| フォーム管理 | React Hook Form 7.71.1 |
| 天気 API | OpenWeatherMap API (v2.5) |
| Linter | ESLint 9 + typescript-eslint + eslint-plugin-react |

---

## ディレクトリ構成

```
/
├── index.html                        
├── vite.config.ts                    
├── tsconfig.json                     
├── package.json                      
├── .env                              # 環境変数（要作成）
└── src/
    ├── main.tsx                      
    ├── App.tsx                       
    ├── App.css                       
    ├── index.css                     
    ├── types/
    │   └── index.ts                  # 全型定義
    ├── db/
    │   └── database.ts               # Dexie DB 定義 + CRUD 操作関数
    ├── api/
    │   ├── weatherAPI.ts             # OpenWeatherMap API 呼び出し + 位置情報取得
    │   └── index.ts                  # API モジュールの再エクスポート
    ├── store/
    │   ├── medicationStore.ts        # 薬剤データの Zustand ストア
    │   └── weatherStore.ts           # 天気データ・設定の Zustand ストア
    ├── utils/
    │   ├── scheduleUtils.ts          # スケジュール生成・マージユーティリティ
    │   └── weatherUtils.ts           # 天気警告判定・アイコン取得ユーティリティ
    ├── pages/
    │   ├── Home/
    │   │   ├── Home.tsx              # ホーム画面（今日の服用予定 + 天気情報）
    │   │   └── Home.css
    │   ├── Medications/
    │   │   ├── Medications.tsx       # 薬剤管理画面（一覧・登録・編集・削除）
    │   │   └── Medications.css
    │   └── Calendar/
    │       ├── Calendar.tsx          # カレンダー画面（月表示 + 日別詳細）
    │       └── Calendar.css
    └── components/
        ├── Layout/
        │   ├── Layout.tsx            # 共通レイアウト（ヘッダー + ナビゲーション）
        │   └── Layout.css
        ├── Header/
        │   ├── Header.tsx            # ヘッダーコンポーネント
        │   └── Header.css
        ├── MedicationCard/
        │   ├── MedicationCard.tsx    # 薬剤情報カードコンポーネント
        │   └── MedicationCard.css
        ├── ScheduleList/
        │   ├── ScheduleList.tsx      # 服用予定リストコンポーネント
        │   └── ScheduleList.css
        └── WeatherAlert/
            ├── WeatherAlert.tsx      # 天気警告 / 良好バナーコンポーネント
            └── WeatherAlert.css
```

---

## セットアップ

### 1. リポジトリをクローン

```bash
git clone <リポジトリURL>
cd <プロジェクトディレクトリ>
```

### 2. 依存パッケージをインストール

```bash
npm install
```

### 3. 環境変数ファイルを作成

プロジェクトルートに `.env` ファイルを作成してください（[環境変数](#環境変数) を参照）。

### 4. 開発サーバーを起動

```bash
npm run dev
```

ブラウザで `http://localhost:5173` を開いてください。

### 5. 本番ビルド

```bash
npm run build
```

ビルド成果物は `dist/` ディレクトリに出力されます。

---

## 環境変数

プロジェクトルートに `.env` ファイルを作成し、以下の変数を設定してください。

```env
VITE_OPENWEATHER_API_KEY=(あなたのAPIキー)
```

| 変数名 | 説明 | 必須 |
|---|---|---|
| `VITE_OPENWEATHER_API_KEY` | OpenWeatherMap API キー（無料プランで取得可） | 天気連携機能を使用する場合のみ必須 |

> API キーは [OpenWeatherMap](https://openweathermap.org/api) で無料登録後に取得できます。  
> キーを設定しない場合、天気連携機能は動作しませんが、薬剤管理・スケジュール機能は使用できます。

---

## 画面構成

### ホーム画面 (`/`)

- 今日の服用予定リストを表示
- 各予定に「服用済み」チェックボタンを表示
- 天気連携の ON/OFF トグルと手動更新ボタン
 - 天気連携が有効な場合、現在地の気温・湿度・天気概要を表示
 - 保管環境に問題がある場合は警告バナー、良好な場合は良好バナーを表示

### 薬剤管理画面 (`/medications`)

- 登録済み薬剤の一覧カード表示
- 新規薬剤の登録フォーム（薬品名・服用量・服用回数・服用時刻・期間・メモ）
- 既存薬剤の編集・削除
- 服用期間が終了した薬剤には「服用終了」バッジを表示

### カレンダー画面 (`/calendar`)

- 月カレンダーで各日付の服用状況を確認
  - `完了数/総数` バッジを各日付に表示
  - 全完了：緑バッジ、一部完了：黄バッジ、未完了：青バッジ
- 日付クリックでその日の服用予定詳細を下部に表示

---

## 天気連携機能

### 動作フロー

1. ホーム画面で天気連携トグルを ON にする
2. ブラウザが位置情報の許可を要求する
3. 許可後、OpenWeatherMap API から現在地の天気データを取得
4. 取得データを IndexedDB に保存し、画面に表示
5. 以降は 6 時間ごとに自動更新（手動更新ボタンでも即時取得可能）

### 警告基準

天気ユーティリティ（`weatherUtils.ts`）に定数として定義されています。気温・湿度が基準値を超えた場合に警告バナーを表示します。

### データ保持期間

天気データは最新から 7 日分のみ IndexedDB に保持されます。古いデータは自動削除されます。

---

## 注意事項

- **オフライン動作:** データは IndexedDB に保存されるため、インターネット接続がなくても薬剤管理・スケジュール確認が可能です。天気連携機能のみインターネット接続が必要です。
- **位置情報:** 天気連携には、ブラウザの位置情報権限が必要です。権限を拒否した場合、天気連携機能は使用できません。
- **データのバックアップ:** データはブラウザの IndexedDB に保存されます。ブラウザのデータ消去（キャッシュ・Cookie 削除など）を行うと、登録データが失われる場合があります。

## 開発にあたって
 当初は薬品の情報を取得するopenFDA APIを導入し、登録した薬品の詳細情報を得る機能の実装を予定していたものの、実装途中で同APIが日本語対応していないことに気づき断念。  
 そこで、代替案として天気APIを用いて得た温度・湿度の情報次第で薬品の保管状況に警告する機能を実装する方針へ変更しました。  
